{% extends 'bookings/base.html' %}
<!-- Load the humanize filter library to format numbers (for price) -->
{% load humanize %}

{% block content %}
<h1>Available Travel Options</h1>
<!-- Search and Filter Form -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Search & Filter</h5>
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label for="type" class="form-label">Type</label>
                <select name="type" id="type" class="form-select">
                    <option value="">All Types</option>
                    <option value="FLIGHT" {% if current_filters.type == 'FLIGHT' %}selected{% endif %}>Flight</option>
                    <option value="TRAIN" {% if current_filters.type == 'TRAIN' %}selected{% endif %}>Train</option>
                    <option value="BUS" {% if current_filters.type == 'BUS' %}selected{% endif %}>Bus</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="source" class="form-label">From</label>
                <input type="text" name="source" id="source" class="form-control" 
                       placeholder="Source city" value="{{ current_filters.source }}">
            </div>
            <div class="col-md-3">
                <label for="destination" class="form-label">To</label>
                <input type="text" name="destination" id="destination" class="form-control" 
                       placeholder="Destination city" value="{{ current_filters.destination }}">
            </div>
            <div class="col-md-3">
                <label for="date" class="form-label">Date</label>
                <input type="date" name="date" id="date" class="form-control" 
                       value="{{ current_filters.date }}">
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                <a href="{% url 'bookings:travel_list' %}" class="btn btn-secondary">Clear</a>
            </div>
        </form>
    </div>
</div>
<div class="row">
    {% for option in travel_options %}
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">{{ option.get_type_display }}</h5>
            </div>
            <div class="card-body">
                <p class="card-text">
                    <strong>From:</strong> {{ option.source }}<br>
                    <strong>To:</strong> {{ option.destination }}<br>
                    <strong>Departure:</strong> {{ option.departure_time }}<br>
                    <!-- intcomma filter adds commas to numbers (e.g., 1000 -> 1,000) -->
                    <strong>Price:</strong> â‚¹{{ option.price|intcomma }}
                </p>
                {% if user.is_authenticated %}
                <a href="{% url 'bookings:book_travel' option.id %}" class="btn btn-primary btn-sm">Book Now</a>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline-primary btn-sm">Login to Book</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <p>No travel options available at the moment.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}